global {
	wan_interface: auto
	log_level: info
	allow_insecure: false
	auto_config_kernel_parameter: true
}

node {
	'socks5://localhost:14514'
}

# https://github.com/daeuniverse/dae/blob/main/docs/zh/configuration/dns.md
dns {
	ipversion_prefer: 4 # IPv6 在某些网络环境下是个悲剧
	upstream {
		alidns: 'udp://dns.alidns.com:53'
		googledns: 'tcp+udp://dns.google:53'
	}
	routing {
		request {
			qname(geosite:category-ads) -> reject
			qname(geosite:category-ads-all) -> reject
			fallback: alidns
		}
		response {
			upstream(googledns) -> accept
			ip(geoip:private) && !qname(geosite:cn) -> googledns
			fallback: accept
		}
	}
}

group {
	proxy {
		policy: min_moving_avg
	}
}

# https://github.com/daeuniverse/dae/blob/main/docs/zh/configuration/routing.md
routing {
	domain(geosite:category-ads) -> block
	pname(geph5-client, geph5-client-gui, gephgui-wry, tailscaled, localsend_app, qbittorrent, AdGuardHome) -> must_direct
	pname(NetworkManager) -> direct
	dip(224.0.0.0/3, 'ff00::/8', geoip:private) -> must_direct
	l4proto(udp) && dport(443) -> block
	dip(geoip:cn) -> direct
	domain(geosite:cn) -> direct
	
	fallback: proxy
}
